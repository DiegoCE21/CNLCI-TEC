@model IEnumerable<CNLCI.Models.Justificante>

@{
    ViewBag.Title = "Justificante";
}

<main>
    <div class="container Marco">
        <div style="margin-bottom: 20px;">
            <center>
                <h1 class="title">Historial de justificantes</h1>
            </center>
        </div>
        <div class="field is-horizontal">
            <div class="field-body">
                
                <div class="column is-offset-3 is-half">
                    <div class="field">
                            <input class="input" type="text" name="matricula" placeholder="Buscar justificante por matrícula" maxlength="11" id="matricula" >
                    </div>
                </div>
            </div>
        </div>

        <div class="container este Marco" id="tablaj">

            <table class="table" id="miTabla">
                <thead>
                    <tr>
                        <th>
                            <center>No. de Justificantes</center>
                        </th>
                        <th>
                            <center>Matrícula</center>
                        </th>
                        <th>
                            <center>Grupo</center>
                        </th>
                        <th>
                            <center>Motivo</center>
                        </th>
                        <th>
                            <center>Fecha</center>
                        </th>

                        <th><center>Acciones</center></th>
                    </tr>
                </thead>
                <tbody id="cuerpo">
                    @foreach (var item in Model)
                    {
                        <tr>

                            <th>
                                <center>  @item.No__justificante</center>
                            </th>
                            <td>
                                <center> @Html.DisplayFor(modelItem => item.Matricula) </center>
                            </td>

                            <td>
                                <center> @Html.DisplayFor(modelItem => item.Grupo_Referente)</center>
                            </td>
                            <td>
                                <center> @Html.DisplayFor(modelItem => item.Motivo)</center>
                            </td>

                            <td>
                                <center>
                                    @if (item.Fecha_del_dia.ToString().Substring(0, 10) == item.Fecha_al_dia.ToString().Substring(0, 10))
                                    {<text>
                                            @item.Fecha_del_dia.ToString().Substring(0, 10)


                                    </text>}
                                else
                                { <TEXT>@item.Fecha_del_dia.ToString().Substring(0, 10) - @item.Fecha_al_dia.ToString().Substring(0, 10)</TEXT>}
                                </center>
                            </td>

                            <td class="is-horizontal">
                                <center>
                                    <p>
                                        @Html.ActionLink("Justificante", "GenerarPDFJ", "Historial", new { id = item.No__justificante }, new { @class = "button is-rounded button-link is-primary", style = "height: auto; max-width: 50%;", target = "_blank" })@Html.ActionLink("Comprobante", "j", "Historial", new { id = item.No__justificante }, new { @class = "button is-rounded button-link", style = "height: auto; max-width: 50%;", target = "_blank" })
                                    </p>
                                 </center>
                            </td>
                        </tr>
                    }</tbody>

</table>


        </div>
    </div>
</main>


<script>

    document.getElementById("matricula").addEventListener("input", function () {
        
        var matricula = this.value;
        console.log(matricula);
        fetch('@Url.Action("buscadorJ", "Historial")', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({ matricula: matricula })
})
.then(response => response.json())
.then(data => {
    console.log(data);

    var cuerpo = document.getElementById("cuerpo");
    cuerpo.innerHTML = '';

    data.forEach(function (i) {
        var fila = document.createElement('tr');
        var c1 = document.createElement('td');
        var c2 = document.createElement('td');
        var c3 = document.createElement('td');
        var c4 = document.createElement('td');
        var c5 = document.createElement('td');
     
        var f;
        if (i.Fecha_del_dia.toString().substring(0, 10) === i.Fecha_al_dia.toString().substring(0, 10)) {
            f = i.Fecha_del_dia;
        } else {
            f = i.Fecha_del_dia + ' - ' + i.Fecha_al_dia;

        }
        var c6 = document.createElement('td');
        var boton = document.createElement('button');
        boton.textContent = 'Justificante';
        boton.className = "button is-rounded button-link is-primary";
        boton.style.height = "50%";
        boton.style.maxWidth = "auto";
        boton.onclick = function () {
            window.open("/Historial/GenerarPDFJ?id=" + i.No__justificante, "_blank");
        };
        var boton2 = document.createElement('button');
        boton2.textContent = 'Comprobante';
        boton2.className = "button is-rounded button-link";
        boton2.style.height = "50%";
        boton2.style.maxWidth = "auto" ;
        boton2.onclick = function () {
            window.open("/Historial/j?id=" + i.No__justificante, "_blank");
        };

        c6.appendChild(boton);
        c6.appendChild(boton2);
        c1.textContent = i.No__justificante;
        c2.textContent = i.Matricula;
        c3.textContent = i.Grupo_Referente;
        c4.textContent = i.Motivo;
        c5.textContent = f;
        [c1, c2, c3, c4, c5, c6].forEach(function (c) {
            c.style.textAlign = "center";
        });
        fila.appendChild(c1);
        fila.appendChild(c2);
        fila.appendChild(c3);
        fila.appendChild(c4);
        fila.appendChild(c5);
        fila.appendChild(c6);
        cuerpo.appendChild(fila);
    });
})
       .catch(error => {
           console.error("Error:", error);
       });
    });
   
</script>